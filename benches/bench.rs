#![feature(test)]

extern crate test;

use std::fmt;
use std::io::Write;
use test::{black_box, Bencher};

struct HexBufferFormat<const N: usize>(&'static [u8; N]);
impl<const N: usize> fmt::Display for HexBufferFormat<N> {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        let mut buffer = const_hex::Buffer::<N>::new();
        f.write_str(buffer.format(self.0))
    }
}

struct StdFormat<const N: usize>(&'static [u8; N]);
impl<const N: usize> fmt::Display for StdFormat<N> {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        for &byte in self.0 {
            write!(f, "{byte:02x}")?;
        }
        Ok(())
    }
}

macro_rules! benches {
    ($($name:ident($enc:expr, $dec:expr))*) => {
        mod decode {
            use super::*;

            mod const_hex {
                use super::*;

                $(
                    #[bench]
                    fn $name(b: &mut Bencher) {
                        let buf = &mut [0; $dec.len() / 2];

                        b.iter(|| {
                            let res = ::const_hex::decode_to_slice(black_box($dec), black_box(buf));
                            black_box(res.unwrap());
                        });
                    }
                )*
            }

            mod hex {
                use super::*;

                $(
                    #[bench]
                    fn $name(b: &mut Bencher) {
                        let buf = &mut [0; $dec.len() / 2];

                        b.iter(|| {
                            let res = ::hex::decode_to_slice(black_box($dec), black_box(buf));
                            black_box(res.unwrap());
                        });
                    }
                )*
            }
        }

        mod encode {
            use super::*;

            mod const_hex {
                use super::*;

                $(
                    #[bench]
                    fn $name(b: &mut Bencher) {
                        let buf = &mut [0; $enc.len() * 2];

                        b.iter(|| {
                            let res = ::const_hex::encode_to_slice(black_box($enc), black_box(buf));
                            black_box(res.unwrap());
                        });
                    }
                )*
            }

            mod hex {
                use super::*;

                $(
                    #[bench]
                    fn $name(b: &mut Bencher) {
                        let buf = &mut [0; $enc.len() * 2];

                        b.iter(|| {
                            let res = ::hex::encode_to_slice(black_box($enc), black_box(buf));
                            black_box(res.unwrap());
                        });
                    }
                )*
            }
        }

        mod format {
            use super::*;

            mod const_hex {
                use super::*;

                $(
                    #[bench]
                    fn $name(b: &mut Bencher) {
                        let mut buf = Vec::with_capacity($enc.len() * 2);

                        b.iter(|| {
                            buf.clear();
                            write!(&mut buf, "{}", HexBufferFormat(black_box($enc))).unwrap();
                            black_box(&buf);
                        });
                    }
                )*
            }

            mod std {
                use super::*;

                $(
                    #[bench]
                    fn $name(b: &mut Bencher) {
                        let mut buf = Vec::with_capacity($enc.len() * 2);

                        b.iter(|| {
                            buf.clear();
                            write!(&mut buf, "{}", StdFormat(black_box($enc))).unwrap();
                            black_box(&buf);
                        });
                    }
                )*
            }
        }
    }
}

benches! {
    bench1_32(bytes::ENC_32, bytes::DEC_32)
    bench2_128(bytes::ENC_128, bytes::DEC_128)
    bench3_4096(bytes::ENC_4096, bytes::DEC_4096)
}

#[rustfmt::skip]
mod bytes {
    use hex_literal::hex;

    pub const ENC_32:   &[u8; 32]   = &hex!("c6ddb328c7e0eb6ce7204daa79b0ae25f632272b8d4c5726c2cbe64cf890cbfa");
    pub const ENC_128:  &[u8; 128]  = &hex!("c1c19d4a28434a8b65272ecf74c4eb0ad8a5106639d54cf417f7423bfecde55e83fef26659ff12f3bd9f19196d6e5f84a4f8a95a3bf3dee61886e25be1ead60864d8722c04288521b153d1bae477a49e000932c83e336830d41d86fb825bfc63e983e54e007532f1c4cd40c7cf346d0f736e03fd20fc65eaabce46f2fe29d550");
    pub const ENC_4096: &[u8; 4096] = &hex!("7ab9bc64153fc2d93d09223d9db09f92522cd1904ef4d798855f200245a18e7428e62be563c9f8c1043078b222388c3cf7deb12297867b2c4e3e751f5ca1107f1d317a85bb6fd6891c2ffb5b1d68b431e50010b7aeb26a39a417fe4c583c68f1a0133610f9f3d440d3be50756504b97bc0af8c01d3c751792d6a549ac4b4cd3b250a3fdb94e512dd8825c21f99b274a39118ae60b200a0ad8f536d268b2c83eaf8c7da21ee430d1335ef0932960bb28954edda29dd8f0be40b5e77c714fb941abb9190fd3bc020b52b2411cc67487071081f34bec7177b944cf47587325e116850a175dcc713a0f01738d2a625e8aad3b0b656d264e40677e6f390b9da8b458db018cda521b4d1c760652fc052f9a8645e144d9407fd3b2cae5f64a8f66261bb344d0dd1a577133a06aec6d0db9b5df3327f4e2a62bf84474c100cb0d4fe33f7f94e970692c3fefdc7f1f0b1ad1c50b729337a2c2dd41f40fde080f60a87c77aae77aab7014b2fb557817998a55913be1b80d8d8c493a0f0367d00732248ab19fc8f159577691624a4280be729d91dc7daf05a6b1a20cbcb3d7c30eb38fdb6b823f2a3a95f907834390608f7fbd4fe399ef03f8121e8a716594fac89752c6878621db5efe829e43a2b882dee0543457deba13380bd4df193d39d88aceb6193f82138a55b036533230db718801da6d9a87b9007f2721f46e6e105a0ec111fb3224109b3ca5c3f29da35b93b28d6911aaafe55e16c7f208ee5a8333a726b40b568d2b4ea4125d7445e6178721988904a8c814d63e5c743eaace60a242f836c3464681c41a370b8453b909031b3caeb241d9641b89a1d170887463c74d19d74b8f6126d1851caf7cba457e571bc29a22944f696377cd30d8400417941aa012a9323c5da8efd7d1ed5074ae5564424f55d50491b61aa7ecd913ffd3523168da2b18f2a2d5a1e5349dbc85edfd9fefec0af4ad90a502eb24c04d3b363b1a2310fb6b4dd3a2a0f78b6e92cccd2526b67604eaffda6a1f7a773069243e04ad3c2132d90f0b69ddab778386479154031739b7b08ccad3ff6c2c9b6f6f11f00edd750ba5a6fbbddec5899fd2cbb5b2963f23fc90d956621dd2a1756803ff6eb6ab9380b009420623e73519b4743baae3d1e8d5ebe622ed3c4ce145445892a75e46691a2cbdfcdbbc23538e9c8863ae410cd7b3e7e00f5266cb0c1c1bcb760008337b89b324fb9749125bd691a3c8f6b79a97899b9592da770d597a91979dc04b6c8fd696b1b2b204c9906edf3efbe2c99d2b8d2f14968f1967631bfb590b753522fe5040ec563a45ff56f05032c216e3346a5b2bc4a753ddf6737bc347432036f36607012828d7881e1314c65b51d4866694afb003bbdd3a29f99be92d186b8b974e5a12e294e9c77960c381cffde5843ca2eb839659ef509c4b56e23126ca958bf02efb0feead97eabfcd4862265a20bb2458181856e1bd9a112f205ffc0ca8faea7a0a819eb0dc43038565db8fa932d849db50e1b76f966c6e45c2ee921f370c02b089195fe1103c50198ab5247e256ccbab0969397449e4b53b41e28ee73dee7be4fb02a5863b6f589c69b5f52ab4a8f1d9620059b8b833f35251049ae8a49efc3c163b7149396cfd2a276f2b365aa110de50fcda299fbb9364c7ee21846097aa6bf5bf7fbda7ae83adfa2804871f100179157573ed5ff81b0e49449b0eaee6486399a7cbdeb40ec41cb2b2e6ef249d003cca022c98056ad34e235ff307e3eb213c7319824d923fb3721ed38689ab6d464da99c6dae31aec3fa3f3df03fb668aca2993f25a1e4a12430c85196e4de55b469faf80961378e4e385181cfbc6581fbcd745b9b4bf1c734d831afff53b9e304acd4a6e61bbb48a44ffa7a5ece73ebe64415e59c27cef3b6718b768d0236af06cc3b38e116ad8f91fbd71a2a61f4e0cd622251138dc385984232ca19eca41af07db5fc1f87eafb8d60c853fbdd32b8d32cf574db31c2c46b4566b1646ee1f79c6a352e2bcfdb2f04189ca857773ad6f1b2f62652f3f367fad2cdf75f360af06056370d609b587beed6d5e8e59cd77fa54ee96203a65d9d1d96a056df2834c314569a165c08cefc7e047106f3fd11e5025be9ccb2aad4958e59ce534a3e0f1f772b4b5d873414dfa07e05e3b665fcb93cd52210c1d80a47320ecf1be0cb2cc0e739139747e8d8464d01b50ddb792c68b658a2972cf3070dc2167fb6b11969e52cea707f7454cdacd5b05467d598a2d8e4dc6532e9cc399cc70292ef63fc2749230c832b5d3695ba5584489d166fdd295b8602151eb94009c6b41e0640e44d776614c0876d8df580c49abaa71e8881b5b7de5ca6acba334f419ef4232e948109dee19e4e3a3fbb6c3bf9cfc02d11f5acdaf2ebc68b528df7c71a07bd60a68b20b027369d0696d5a02b09bbb3db7bee0b00ed11486cedb51680f792dec2483fb95d607920b15c17769706050782c30fe9dbaee0ad7ccf2cc467eab008d46d6ec9525d98a238fd1a4390add976953d4c4bb4e0c5a08779f38e5bdab2f937a72ad864ff6bee9655dfa59d5ac3e90e0e3bee7fcabb6dbb95d510e11df1c48a8ba9b00af841e7487d3840e4b517559dd63dc91c2a947adc87090f77b4ca40acc884c54d3451349ce946db298b2ab1d76448dcbf7fbddfd6437d780be294179f327bdc64f7f1a4274b1e1d986e92a0f1495c3fed33967dd5626c03f34e47bf280f3ce4c880b7845d2894922e0490e75f3704735d1f4e4f7e495883e7c2ac7cc00659fc1d543a923d913c23d69514f20c0b7fc42d02ee0ca4d133f360e145ecd644f3d1e38702b0d52ee4a0e23ca7f162168bd26c3231d0ed09611e9028253fb6fa9c1ce5024b936926d9295c55c245373489d318e8d3b7bdae1903a52c22b798e69851e224cea1e16463c862036c7e2dcf767894caee2713f5f0864dead7c701c92e9f7cde906ff30ff222dfaad894a6be69d438c5a6db13b726a1b7bd56d2163be4b53383f9079194d209a585a36cc7d6513e3f6de7219ca24898db46ffbbb7b03368cb352c50ca47eddac3e90915c24e0cc70220d8f964d3fa6bad83bea976bc125b77490db1a61e4f29f6c656febd24c39ceccedc4d371332c8222597eb0725f75c610bc804bee63a67890c3fa3571e066d75958247a91af2e48fa5337639d317880af53d951583025c170d09bca0721096b95007507ba0f3203c589f6eb813be2b3ec300643c0bd51c1d048a1eabe3784d68e5a6f9db5b623354e1f7ae69604f4d9003330c09c860763169a9c3339d173434c879fcd07343b7c31460cdca5a223e41f12b6a7caa145131610260130f54446a350afcacd0cb441f2d4c42ec1928f53f19ed3337ac3c18949519fb11debd7779a7c76467fab34d929297bbe61f7686f8670a7f0f88fcb88296d251356c5d8f4f3f5a07c4c9530e04b43f0fda14c10d508574a3bf3ccf1baed4f0b6996b972fe44dd437977a472d62ca68aa98ddd69feea9a25e379e2de63014bb230b70d88785cef3906bd263634a161233ca220e0d7af4336e5fe414aadcb0a366083584f47e442911228d794f7b03362fe0e07b42ab08e7d1f2f3965e2ef1854c6689f8935d6d09188f9fb720bc2effb6e3aa316807c57b76e51629b926590fd9d317715b05c60df51f667a7dcfca6493187cb50ab1a5fffc175b133a14f91ff2320a7f7683485367dd897030bb8278f442ab79470a65b4e5adaee72175702fb0fb5c1e70faa937301a1ee0955961b9d843b14887f3bb6f5bf9ae809ccdc5f61b9e0aa4bdae7612d461964625ddf2b314b909becf3b4dc81467aed657c65ccaf961c2bee176f20fcf44385c030bebd8ffaed3bf6ce14fd3aa9beb549da955147fbe37e191f975961bf234c583ad2b0ccd9f81b2b1fd00fd5fa1d51e7e497ac1a469393bbc58b82af2f9beec41fd4d2f498dcae448f1f6f402d7c85b1f46bef33622da4fc2c72109f564a1393beabb52cb9bb18e7ece3d00a982fa2dbe41c3b1c3204dc1e1e2dc880824cdeea858f996f06a0c6f3b6a33fff4a44db2707a3ff4b0ee63bde964f0f1d869c37d1cf6fec3399a187f1272e6cf4a214dc34cc914d58fb9ac38b60356d4c73807650c34a23ea763c7018f7c0b22782f7fd842c475bb385257229a03bff09bd7a1c69b70a6fd5ef4460ddd43dbd63b6dfcac00591dafd7657ba0cfbefc193bb4361bfd2a847173c54feb7f25f93678e27167b7beb84eaa8e70da714ab83ea75f018e43c649e3efa2c867597becdb73352cae6e10f6cfe3c621ede7d2cedac145479ccf5f0176ddf221701f1ec51dc40772df0991d3c2f89c28669bca9736f00cb39015f74987b09599b1cf0963d587ba1bea9f68ca3ddab3ee03d0cc1e5dd13b1d1cb01641d610c88212500ce76ba313ac360952f56de1c4053dbe9a1b9d7258c4063d12363daf547f920a259d1e8177e46ed8d98f940977ad6f8cf1373f4f27718f8de815e3cc35078f393f968844fb677f2c16ad824d9f15dc0ef91de5a161cf7b686cc919512e9653236145b00167adcf60f25ff2e04ba6d5f2e59c2bf3dbd27b248ea0d82558b852caf900bf638a0a1703247a39538755e2daabf76d0ac47415eb7707b8400e2990d1542497233f989630613f106d7a722098bdf51ac2775a09c5789d16db42f8a7203969ab1551dfa3738215e4df23812716305ac40f69c236664bdcc6f19e028bae4d68a2c7d587b5a4f8b555568d77c61bbf794924ce18ec34c08f46fa17363350bf48a9880d934f5628436f7ef779750a7f54600a31515145155eb4e19338554bfd6256f53526ddf8f07e6d1a5c20d3a55fa603bd6e4781e54653270b8f377b75ce6260ff5153b0f20b7197972a4a320d3787e3d795353782c4c299bfd2dcbced2e5dd1b98ca72f87671e9a06689eba9ab58a13bb2fb856a579a654f74377d868c14c4d32c436759da19167e227c85017a8ba3734fcc7467e59597ee65b344e446abf9e2e6321da203829c40d4ed6da5de56b7b374125ffb07f45820b9d378c434c218455df145520bf51ec2dc3adde3d69cbb5e25b42a400b833d564bbaebd728500fc68aa6d7a84a727c258386c40d2dd0284643b8090a819cb0de4c5f8f702d1db64082cdb2c2c892c584667d90f4af35a22ebc34d811c55e7c61a1e05f47bd672d33049e0bc7500920897cd6f9928e9a54676541ca5d4620f4f7c7aed444b84d1977d36ef97e0e5dc556da4900e2998d3a924cd183ab901860df078c047492b7c284e49d95058d87c9434385b49f8032d47acd69b9168b9c45c228e6af7c7b79b86af67fd03f9b1ca279ae2e94056f7399f4f437733d70bc3b6d8317d1b0397341a204010b2396fc76b786d2bb2e19985039f020b9aa12206aefb1943fae16a485d6f9854e6792be2f9d1bc901d98b59edf9b80f7b8a682f8e0e93e87929d7285ec8442f1d3e5b6158efb338d4b330195238e645d3276496241cec27056a205b59d4f1edc2d505ab69b506d49634e637e4634707f66500dc576895ed12118c6cd22ecac150aae81ae827b06cde0913b4d79c306848736ffb0f85d60f4f8acfeec16e7c17af748b93dc6eff08a77672ddc21fddcd729cd84eb416c7003f15a30ab0b756a03cc0674f9c7818eb1c197d81af566751473a3f2780356039057a834a35aed5fbe1a0ad483600721184aa4b26abd1a98413387c28b13cee1bb141d957221e9ff428b1ef262038b24bee5636760af8a1a1e2a3cc3bcbf44861abecf45f36f4a4d02fe84314016752fd7335fbd8f6d0");

    pub const DEC_32:   &str = "17fcf46621eb6d2aefa3edb5cfe90e2f";
    pub const DEC_128:  &str = "fa5943385153d8d7383f5514d5af03a811ef6c50e143362f42604e6cee015694fef5b57457c48e2120b706960f1aa8ca8b2b689367e383060403f2c75322bf92";
    pub const DEC_4096: &str = "50fe36085e0358265f268b8a346dcf1ad21af411014847ee7acdbb514d481547ced9588d7340340f53ed238e81ed95d7222f31b5240716714ed14ad242a339ba384ac55abe04a2a7fe29dad466d6295abe8a2721ae631daaf8c252d3018583087b0dc04b751e8674cb3327ded952dbe4de5efda1a024612ad39d5c2cbb42c4dbc14a60253d198574348f2c9cd86fbb85dfd47f2a065645d0e5fb50465573676aa51b4c9f3fefbee1c26914692423529ffcd12cb005c9cf11e2d4d8531a80643cc9a7f750af11e382c3b91a20ff6fa115d90fd2fb6f9c02e1589abb6f58d128b58f46292879dd9d3464d1bc54f3fff4a51662f8dca64fc6c93f5e7c6093a4a4bbf7e6b663ee4b8dce74bcde64071372b6464e485f5b84d078b64ba01735b00fe3ea777494c95d04934b9cef30c08c5f1b4d22df4fd4395089c8056dc0cec9600d4647a6aa738065d2466e23a616e5d0dae28ea8635ebf992a6dda3452a11ba96744737a1f1f663f4c3fcca70206fd461a005da15702b69520af0e7a0f2e259b6ac7165fd31eeb18750c8fce982bbb2bd80adaffdea327cc59c2557f9ebb0c833bfffc5d0fec32b927f42d859d338c83451667d7c090c5bd40cf60ccf11c2ecde16ae7e64755826a8dfa9ca074e1e4951357cc2c881736a37ff2b429cea6601e85e5129dbd1a889e68fac59293ac3a200f455f78f3323577750c7dfee9b5de34401ec67bb0274caf72e192fc6bbd8802d5737d2f9d80b8c9a0b1f284ffcc3e0806dcd4bf2943f2e60e15afe12247f2952d46e40e3597f3bd252696c906e29ddbcefe14893bb6959e5a7e7b0e74c53cfd1480d0201a99f44b55c561434216dfb4e1541850258d102f71ee768e57a49f55a6de94df9dd3f712a17daa61b5cc2bb8daf50968168ff374b9923f9d668046a974b0d21b316e217256c744e1b5fdb245a885d7d1eddd4c892fca11d48cf2353d3ca6111faa52eefea861c4be4e348ed33a3694f8039a27679e2d2d279e79ec8d755b5543768c96325883f12ecedf32e078fb1ea016ffdf92fec58d41a81d458f8eee0848f11b0ab94cf61a220c8916b5ecbd23e8a2a8f8ebe5218ec7d66a0a9ec9bab6b00cc86f3930fab52e54454f97df355870592c3ae074281e0b81ec103aea2b879aa4f61ab606c8fe5f21c841b1d3eb67b72f7589023c537a9027c12f50f83d827f45693338ad233347cf2f6fb90180fadf0f718186615cdefe044a777bf454c9f025bf26726acdab1fadc6112ca9f10db89381bb0c75d38e5960897cf2e71093fb5d86341362fdbb51c2f9608c067118983d3064266b65593142b0f545e47f441658fac423d1d9474713f581f1e6f033a3c8ce4dbdc5d25d5435117d8ede16073c068aa1bd019bcec8b1952750fcdeaf797a07932025704a5f42a796ad6e578b5dbf1ad1e6be02bd6a3683c077e27cdb2da4e5ed3caefbd08b1539d96a4ae77246e134300becdfc9a7c970a9aafa585a2e1a934fec89e2b17620b23aa581ef9b7096bfde51e227db23b97541333f219e634fe869705236cba9db31038ddaa5a632fd43f4457f620f4eb8c2d24dfa694515dd287105465ba9fc0e09d51730cc5c7c55dc3863673ebf0dd8b4b90e9d5b60b5ea9513b1f9f6383f128a6b5dc84e548cffe981e878c28e9501bcf653ab0b114728307e1e9ae50a7b0e91df1140da66adb31283bb91b211b9fcbd42bd34d211e2fdb897320fa0a5c6b15937562387fca383d7da966e8f94117e0c1eff6f5e51702b3ea2913f2029d0190407807a5b23bd0b3da1c2c64a4df740b58ada9d394d08a51455ead6f826a3bffe9250c2df2ce659d02844d6e521ff5d754550a7f704ce6995a0a96aad536b7e0e43568d441406d2e2b9feeece6182be111a12d7b64247b09a8837af4695bcb7cec85606f3c400ce2c6dc1d9e6429c0ca9ed8d40886da060ecea75a83efff2794ac01565778ab4cf076915f597524522f3c45f6ea0db4c83f364fd44062b52a51ac70743bd071dbdec3a63482951d07ffcb5ef8b83aacbfe5cbda2f7f241bcf0acc0804a3d5e9e65836e2bf1986ae13dbb361954ec0a36733ee659136767b779451df5684e90adff55440960b9a6602df4c6084e011c976c25d33cccab6763f230e1df8e5b0c41c6a1dbadca5f88785c931f8d9a1283f2690f6dfef5d20fcca2edd3c599d1f64cdbe815bc7e12ae700db9c928ad401b6aeb2a2ddccd1e921513e2950cd35a220ff64d201e9b52416c2a4b6881e8563cdb94dbf132786303d6d1f0a9f04d4e56c12201e45f6371f94431c7bb3111ece2154834b5640270eefb688f3751c4b98564fd71ba3c07806afe6dfe6e64e1c26cc7c1a8b437a829ac690a6f13603d622e6f3241e5592852ba7b1b544a3429d972e1470e449f1e7337cf3a672991b1c59b804164f2de4074608e69f53e6c6db01715e5f642c93c253a8545e8b70946443e60a934a2867d9ffc6ef0885a7c4756368f0dff8184e12c87a369a0d03e341e69ceac9555585df7b3a402ac06ed934678b0d882f1bb210feeaa6641503a9f76db8e25dcccc732161a010453ede57890bc1ef45b182c1423bdb18a186cb630d8c620d570a6638fd9c21764c2f0a1b5c2778cbd7d66e4f86c3b858659dbd67ec74d5ceaf9c4054cf21c419093647fb6636000d5ea0aa55d99a96f7d633a240db356c68fdbbeca90fc83f80d187e60f577c96d71c1eb951fed1e7f656927252e864cc2e736b711d033cd41ed8fb308a88564c9b7b34cc9d187a9a9e865573fb771a77df554037ca376bcce948b63aa1d38ab076bc0bf582ce8a42218d1fb3389f6d803b6c0623fce8a91f86146a6eb62023f21f22f4615d8f9daf7de826258122d84d92504973fbde421d0ca41fbc488";
}
